<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>sosiologe</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { margin:0;font-family:sans-serif;background:#0f172a;color:white }
header { display:flex;justify-content:space-between;align-items:center;padding:10px;background:#020617 }
button,input,textarea { border-radius:8px;border:none;padding:8px }
button { background:#2563eb;color:white }
#auth,#app { max-width:500px;margin:auto;padding:15px }
.post { background:#020617;margin:10px 0;padding:10px;border-radius:10px }
.comment { font-size:14px;margin-left:10px;color:#cbd5f5 }
.admin { color:#f87171;font-size:12px }
</style>
</head>
<body>

<header>
<b>sosiologe</b>
<span id="userInfo"></span>
</header>

<div id="auth">
<h3>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
<input id="name" placeholder="–ò–º—è"><br><br>
<input id="email" placeholder="Email"><br><br>
<input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å"><br><br>
<button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
<button onclick="login()">–í—Ö–æ–¥</button>
</div>

<div id="app" style="display:none">
<textarea id="postText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?"></textarea><br><br>
<button onclick="addPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
<div id="posts"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBMhpCKnZnzWryB5q614gbRUt7qdWL-4wg",
  authDomain: "sosiologe.firebaseapp.com",
  databaseURL: "https://sosiologe-default-rtdb.firebaseio.com",
  projectId: "sosiologe"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

const ADMIN_UID = "fJj3X9fkrISVtvbSK1Ezf9Njpzz1";

auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById("auth").style.display="none";
    document.getElementById("app").style.display="block";
    document.getElementById("userInfo").innerText=user.email;
    loadPosts();
  }
});

function register(){
  auth.createUserWithEmailAndPassword(
    email.value,password.value
  ).then(u=>{
    db.ref("users/"+u.user.uid).set({
      name:name.value || "–ë–µ–∑ –∏–º–µ–Ω–∏",
      banned:false
    });
  }).catch(e=>alert(e.message));
}

function login(){
  auth.signInWithEmailAndPassword(
    email.value,password.value
  ).catch(e=>alert(e.message));
}

function addPost(){
  const user = auth.currentUser;
  if(!user) return;
  db.ref("posts").push({
    uid:user.uid,
    text:postText.value,
    likes:{},
    time:Date.now()
  });
  postText.value="";
}

function loadPosts(){
  db.ref("posts").on("value",snap=>{
    posts.innerHTML="";
    snap.forEach(p=>{
      const d=p.val();
      const div=document.createElement("div");
      div.className="post";
      const liked=d.likes && d.likes[auth.currentUser.uid];
      div.innerHTML=`
        <b>${d.uid}</b>
        <p>${d.text}</p>
        <button onclick="like('${p.key}')">
          ‚ù§Ô∏è ${d.likes?Object.keys(d.likes).length:0}
        </button>
        <button onclick="comment('${p.key}')">üí¨</button>
        ${auth.currentUser.uid===ADMIN_UID?
          `<button class="admin" onclick="ban('${d.uid}')">BAN</button>`:""}
      `;
      posts.appendChild(div);
    });
  });
}

function like(id){
  const uid=auth.currentUser.uid;
  db.ref("posts/"+id+"/likes/"+uid).set(true);
}

function comment(id){
  const text=prompt("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π");
  if(text)
    db.ref("posts/"+id+"/comments").push({
      uid:auth.currentUser.uid,text
    });
}

function ban(uid){
  if(confirm("–ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?")){
    db.ref("users/"+uid+"/banned").set(true);
    alert("–ó–∞–±–∞–Ω–µ–Ω");
  }
}
</script>
</body>
</html>
