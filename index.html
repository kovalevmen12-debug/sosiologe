<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>sosiologe</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:sans-serif;background:#f2f2f2}
header{background:#111;color:#fff;padding:10px;display:flex;justify-content:space-between;align-items:center}
button{padding:8px 12px;border:none;border-radius:6px;cursor:pointer}
#auth,#profile{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal{background:#fff;padding:20px;border-radius:12px;width:90%;max-width:400px}
.post{background:#fff;margin:10px;padding:10px;border-radius:10px}
.post img{max-width:100%;border-radius:8px}
.comment{font-size:14px;margin-left:10px}
.hidden{display:none}
</style>
</head>
<body>

<header>
  <b>sosiologe</b>
  <img id="avatarBtn" src="https://i.imgur.com/6VBx3io.png" width="40" style="border-radius:50%;cursor:pointer">
</header>

<div id="feed"></div>

<button onclick="newPost()" style="position:fixed;bottom:20px;right:20px">Ôºã</button>

<!-- AUTH -->
<div id="auth">
  <div class="modal">
    <h3>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
    <input id="email" placeholder="Email"><br><br>
    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å"><br><br>
    <input id="name" placeholder="–ò–º—è (–¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)"><br><br>
    <button onclick="login()">–í–æ–π—Ç–∏</button>
    <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
  </div>
</div>

<!-- PROFILE -->
<div id="profile">
  <div class="modal">
    <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
    <input id="pname"><br><br>
    <input id="pavatar" placeholder="URL –∞–≤–∞—Ç–∞—Ä–∫–∏"><br><br>
    <button onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button onclick="logout()">–í—ã–π—Ç–∏</button>
    <button onclick="closeProfile()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBMhpCKnZnzWryB5q614gbRUt7qdWL-4wg",
  authDomain: "sosiologe.firebaseapp.com",
  databaseURL: "https://sosiologe-default-rtdb.firebaseio.com",
  projectId: "sosiologe",
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();
const ADMIN_UID="fJj3X9fkrISVtvbSK1Ezf9Njpzz1";

auth.onAuthStateChanged(u=>{
  if(!u){authBox(true);return}
  authBox(false);
  loadFeed();
});

function authBox(s){document.getElementById('auth').style.display=s?'flex':'none'}

function login(){auth.signInWithEmailAndPassword(email.value,password.value)}
function register(){
  auth.createUserWithEmailAndPassword(email.value,password.value)
  .then(r=>db.ref("users/"+r.user.uid).set({name:name.value,avatar:""}))
}

function logout(){auth.signOut()}
avatarBtn.onclick=()=>profile.style.display='flex';
function closeProfile(){profile.style.display='none'}

function saveProfile(){
  const u=auth.currentUser;
  db.ref("users/"+u.uid).update({name:pname.value,avatar:pavatar.value});
  closeProfile();
}

function newPost(){
  const text=prompt("–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞");
  const img=prompt("URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)");
  if(!text)return;
  db.ref("posts").push({
    uid:auth.currentUser.uid,
    text, img, time:Date.now()
  });
}

function loadFeed(){
  feed.innerHTML="";
  db.ref("posts").on("value",s=>{
    feed.innerHTML="";
    s.forEach(p=>{
      const d=p.val();
      const div=document.createElement("div");
      div.className="post";
      div.innerHTML=`
        <b>${d.text}</b><br>
        ${d.img?`<img src="${d.img}">`:""}
        <br>
        <button onclick="like('${p.key}')">‚ù§Ô∏è</button>
        <button onclick="comment('${p.key}')">üí¨</button>
        ${auth.currentUser.uid===ADMIN_UID?`<button onclick="ban('${d.uid}')">üö´</button>`:""}
      `;
      feed.prepend(div);
    });
  });
}

function like(id){
  const uid=auth.currentUser.uid;
  db.ref(`likes/${id}/${uid}`).set(true);
}

function comment(id){
  const c=prompt("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π");
  if(c)db.ref(`comments/${id}`).push({uid:auth.currentUser.uid,text:c});
}

function ban(uid){
  db.ref("banned/"+uid).set(true);
  alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–∞–Ω–µ–Ω");
}
</script>
</body>
</html>
