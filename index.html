<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>sosiologe</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:white}
.card{background:#11162a;padding:15px;border-radius:10px;margin:10px}
input,button{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:none}
button{background:#22c55e;font-weight:bold}
.post{background:#0f172a;padding:10px;border-radius:8px;margin-top:8px}
.like{cursor:pointer;color:#22c55e}
.hidden{display:none}
</style>
</head>

<body>

<div class="card" id="auth">
  <h3>Вход</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Пароль">
  <button onclick="login()">Войти</button>
  <button onclick="register()">Регистрация</button>
</div>

<div class="card hidden" id="app">
  <h3>Новый пост</h3>
  <input id="postText" placeholder="Что нового?">
  <button onclick="addPost()">Опубликовать</button>

  <h3>Лента</h3>
  <div id="feed"></div>

  <button onclick="logout()">Выйти</button>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged,signOut} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import {getDatabase,ref,push,onValue,set,update} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyBMhpCKnZnzWryB5q614gbRUt7qdWL-4wg",
  authDomain:"sosiologe.firebaseapp.com",
  databaseURL:"https://sosiologe-default-rtdb.firebaseio.com",
  projectId:"sosiologe",
  storageBucket:"sosiologe.firebasestorage.app",
  messagingSenderId:"651066103994",
  appId:"1:651066103994:web:13f35d4e31bba79c160a83"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getDatabase(app);

window.register=()=>createUserWithEmailAndPassword(auth,email.value,password.value);
window.login=()=>signInWithEmailAndPassword(auth,email.value,password.value);
window.logout=()=>signOut(auth);

onAuthStateChanged(auth,u=>{
  authBox.classList.toggle("hidden",!!u);
  app.classList.toggle("hidden",!u);
});

window.addPost=()=>{
  const u=auth.currentUser;
  push(ref(db,"posts"),{
    text:postText.value,
    author:u.email,
    likes:{}
  });
  postText.value="";
};

onValue(ref(db,"posts"),snap=>{
  feed.innerHTML="";
  snap.forEach(p=>{
    const d=p.val();
    const likesCount=d.likes?Object.keys(d.likes).length:0;
    feed.innerHTML+=`
      <div class="post">
        <b>${d.author}</b><br>
        ${d.text}<br>
        <span class="like" onclick="like('${p.key}')">
          ❤️ ${likesCount}
        </span>
      </div>`;
  });
});

window.like=(id)=>{
  const u=auth.currentUser;
  update(ref(db,"posts/"+id+"/likes"),{
    [u.uid]:true
  });
};
</script>

</body>
</html>
