<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>sosiologe</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#e5e7eb}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 15px;background:#020617}
button{background:#2563eb;color:#fff;border:none;padding:8px 12px;border-radius:6px}
input,textarea{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:none}
.post{background:#020617;padding:10px;border-radius:10px;margin:10px 0}
img{max-width:100%;border-radius:10px}
.hidden{display:none}
</style>
</head>
<body>

<header>
<b>sosiologe</b>
<button id="profileBtn">–ü—Ä–æ—Ñ–∏–ª—å</button>
</header>

<div id="auth">
<h3>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
<input id="name" placeholder="–ò–º—è (–¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)">
<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
<button onclick="login()">–í–æ–π—Ç–∏</button>
<button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
</div>

<div id="app" class="hidden">
<h3>–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</h3>
<textarea id="postText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?"></textarea>
<input id="postImg" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
<button onclick="addPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
<div id="posts"></div>
</div>

<div id="profile" class="hidden">
<h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
<input id="profName" placeholder="–ò–º—è">
<input id="profAva" placeholder="–ê–≤–∞—Ç–∞—Ä (URL)">
<button onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
<button onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged,signOut} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import {getDatabase,ref,push,set,onValue,remove,update} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBMhpCKnZnzWryB5q614gbRUt7qdWL-4wg",
  authDomain: "sosiologe.firebaseapp.com",
  databaseURL: "https://sosiologe-default-rtdb.firebaseio.com",
  projectId: "sosiologe",
  storageBucket: "sosiologe.appspot.com",
  messagingSenderId: "651066103994",
  appId: "1:651066103994:web:13f35d4e31bba79c160a83"
};

const ADMIN_UID = "fJj3X9fkrISVtvbSK1Ezf9Njpzz1";

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getDatabase();

const authBox=document.getElementById("auth");
const appBox=document.getElementById("app");
const profileBox=document.getElementById("profile");
const postsBox=document.getElementById("posts");

onAuthStateChanged(auth,user=>{
 if(user){
  authBox.classList.add("hidden");
  appBox.classList.remove("hidden");
  loadPosts();
 }else{
  authBox.classList.remove("hidden");
  appBox.classList.add("hidden");
 }
});

window.register=()=>{
 createUserWithEmailAndPassword(auth,email.value,pass.value)
 .then(r=>set(ref(db,"users/"+r.user.uid),{
  name:name.value||"–ë–µ–∑ –∏–º–µ–Ω–∏",
  avatar:"",
  banned:false
 }));
}

window.login=()=>{
 signInWithEmailAndPassword(auth,email.value,pass.value);
}

window.logout=()=>signOut(auth);

window.addPost=()=>{
 const u=auth.currentUser;
 if(!u)return;
 push(ref(db,"posts"),{
  uid:u.uid,
  text:postText.value,
  img:postImg.value,
  likes:{},
  time:Date.now()
 });
 postText.value="";postImg.value="";
}

function loadPosts(){
 onValue(ref(db,"posts"),snap=>{
  postsBox.innerHTML="";
  snap.forEach(p=>{
   const d=p.val();
   const div=document.createElement("div");
   div.className="post";
   div.innerHTML=`
    <p>${d.text}</p>
    ${d.img?`<img src="${d.img}">`:""}
    <button onclick="like('${p.key}')">‚ù§Ô∏è ${d.likes?Object.keys(d.likes).length:0}</button>
    ${auth.currentUser.uid===ADMIN_UID?`<button onclick="del('${p.key}')">üóë</button>`:""}
   `;
   postsBox.prepend(div);
  });
 });
}

window.like=id=>{
 const u=auth.currentUser;
 update(ref(db,"posts/"+id+"/likes/"+u.uid),true);
}

window.del=id=>remove(ref(db,"posts/"+id));

profileBtn.onclick=()=>{
 appBox.classList.add("hidden");
 profileBox.classList.remove("hidden");
}

window.saveProfile=()=>{
 const u=auth.currentUser;
 update(ref(db,"users/"+u.uid),{
  name:profName.value,
  avatar:profAva.value
 });
}
</script>
</body>
</html>
