<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>sosiologe</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body{margin:0;font-family:system-ui;background:#0b0f1a;color:#fff}
nav{display:flex;gap:8px;padding:10px;background:#0f172a;position:sticky;top:0}
nav button{flex:1;padding:10px;border:0;border-radius:10px;background:#1f2937;color:#fff}
nav button.active{background:#22c55e;color:#052e16}
.card{background:#11162a;border-radius:14px;padding:14px;margin:10px}
.hidden{display:none}
input,select,textarea,button{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:0}
button.primary{background:#22c55e;color:#052e16;font-weight:600}
button.ghost{background:#1f2937;color:#fff}
.post{background:#0f172a;border-radius:10px;padding:10px;margin-top:8px}
.row{display:flex;gap:8px}
small{opacity:.7}
</style>
</head>
<body>

<nav>
  <button id="tabCalc" class="active" onclick="showTab('calc')">üí± –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
  <button id="tabFeed" onclick="showTab('feed')">üì∞ –ü–æ—Å—Ç—ã</button>
</nav>

<!-- –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† -->
<div id="calc" class="card">
  <h3>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç</h3>
  <input id="amount" type="number" value="1" />
  <div class="row">
    <select id="from">
      <option>USD</option><option>EUR</option><option>RUB</option><option>UAH</option>
    </select>
    <select id="to">
      <option>EUR</option><option>USD</option><option>RUB</option><option>UAH</option>
    </select>
  </div>
  <button class="primary" onclick="convert()">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
  <p id="result"></p>
</div>

<!-- –õ–ï–ù–¢–ê -->
<div id="feed" class="hidden">
  <div class="card">
    <h3>–ù–æ–≤—ã–π –ø–æ—Å—Ç</h3>
    <textarea id="postText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?" rows="3"></textarea>
    <button class="primary" onclick="addPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
  </div>
  <div id="posts"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBMhpCKnZnzWryB5q614gbRUt7qdWL-4wg",
  authDomain: "sosiologe.firebaseapp.com",
  databaseURL: "https://sosiologe-default-rtdb.firebaseio.com",
  projectId: "sosiologe",
  storageBucket: "sosiologe.firebasestorage.app",
  messagingSenderId: "651066103994",
  appId: "1:651066103994:web:13f35d4e31bba79c160a83"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// --- Tabs
window.showTab = (t)=>{
  calc.classList.toggle('hidden', t!=='calc');
  feed.classList.toggle('hidden', t!=='feed');
  tabCalc.classList.toggle('active', t==='calc');
  tabFeed.classList.toggle('active', t==='feed');
};

// --- Auth (–∞–Ω–æ–Ω–∏–º–Ω–æ, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–æ —Å—Ä–∞–∑—É)
signInAnonymously(auth);

// --- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (—Ä–µ–∞–ª—å–Ω—ã–π API, –±–µ–∑ –∫–ª—é—á–∞)
window.convert = async ()=>{
  const a = Number(amount.value||1);
  const f = from.value, t = to.value;
  result.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞...";
  const r = await fetch(`https://api.exchangerate.host/convert?from=${f}&to=${t}&amount=${a}`).then(r=>r.json());
  result.textContent = `${a} ${f} = ${r.result.toFixed(4)} ${t}`;
};

// --- –ü–æ—Å—Ç—ã + –ª–∞–π–∫–∏ + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
window.addPost = ()=>{
  if(!postText.value) return;
  push(ref(db,'posts'),{text:postText.value,likes:0,comments:{}});
  postText.value='';
};

onValue(ref(db,'posts'), snap=>{
  posts.innerHTML='';
  snap.forEach(s=>{
    const p=s.val(); const id=s.key;
    const c=document.createElement('div');
    c.className='card post';
    c.innerHTML=`
      <div>${p.text}</div>
      <small>‚ù§Ô∏è ${p.likes||0}</small>
      <div class="row">
        <button class="ghost" onclick="like('${id}', ${p.likes||0})">–õ–∞–π–∫</button>
      </div>
      <input placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" id="c_${id}">
      <button class="ghost" onclick="comment('${id}')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <div id="cm_${id}"></div>
    `;
    posts.prepend(c);
    const cm=c.querySelector(`#cm_${id}`);
    if(p.comments) Object.values(p.comments).forEach(x=>{
      const d=document.createElement('div'); d.innerHTML=`<small>üí¨ ${x}</small>`; cm.appendChild(d);
    });
  });
});

window.like = (id, v)=> update(ref(db,'posts/'+id),{likes:v+1});
window.comment = (id)=>{
  const i=document.getElementById('c_'+id);
  if(!i.value) return;
  push(ref(db,'posts/'+id+'/comments'), i.value);
  i.value='';
};
</script>
</body>
</html>
